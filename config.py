# config.py
"""
IMD Strategic Consulting - Configuration
증상 카드, 혀 진단 데이터, 시스템 설정
"""

# ============================================
# 앱 기본 설정
# ============================================
APP_TITLE = "IMD Strategic Consulting"
APP_ICON = "💼"
LAYOUT = "centered"

# ============================================
# 디자인 컬러 (현재 화이트 모드 유지)
# ============================================
COLOR_PRIMARY = "#111827"
COLOR_BG = "#FFFFFF"
COLOR_TEXT = "#111827"
COLOR_AI_BUBBLE = "#F9FAFB"
COLOR_USER_BUBBLE = "#E5E7EB"
COLOR_BORDER = "#E5E7EB"

# ============================================
# 증상 선택 카드 (Step 1)
# ============================================
SYMPTOM_CARDS = {
    '만성피로': {
        'icon': '🔋',
        'title': '만성 피로 / 보약',
        'desc': '아침에 일어나도 피곤하고 기운이 없어요',
        'target': '고가 매출 타겟'
    },
    '통증': {
        'icon': '🤕',
        'title': '통증 / 교통사고',
        'desc': '목, 허리, 관절이 아프고 결려요',
        'target': '추나/침 프로그램'
    },
    '소화기': {
        'icon': '🥣',
        'title': '소화기 / 위장',
        'desc': '더부룩하고 속이 불편해요',
        'target': '위장 한약 프로그램'
    },
    '다이어트': {
        'icon': '🌿',
        'title': '다이어트 / 해독',
        'desc': '살이 안 빠지고 몸이 무거워요',
        'target': '다이어트 프로그램'
    }
}

# ============================================
# 혀 진단 데이터 (Step 2)
# ============================================
TONGUE_TYPES = {
    '담백설': {
        'emoji': 'images/pale_tongue.png',
        'name': '담백설 (淡白舌)',
        'visual': '핏기 없고 하얀 혀',
        'analysis': '혀가 창백하고 핏기가 없습니다. 이는 **기혈(氣血) 부족**의 대표적인 신호입니다.',
        'symptoms': '어지럽고, 기운이 없으며, 추위를 많이 탑니다',
        'warning': '단순 피로가 아니라 **에너지 생산 자체가 멈춘 상태**입니다',
        'scores': {
            'energy': 30,      # 기력
            'circulation': 40,  # 순환
            'digestion': 50,   # 위장
            'sleep': 35,       # 수면
            'immunity': 45     # 면역
        }
    },
    '치흔설': {
        'emoji': 'images/tooth_tongue.png',
        'name': '치흔설 (齒痕舌)',
        'visual': '가장자리에 이빨 자국이 선명한 혀',
        'analysis': '혀 가장자리에 **톱니바퀴 같은 이빨 자국(치흔)**이 선명합니다. 이것은 단순 피로가 아닙니다.',
        'symptoms': '몸이 붓고, 소화가 안 되며, 늘 나른합니다',
        'warning': '**비위(소화기) 기능이 무너져, 몸에 습기(노폐물)가 가득 찬 상태**입니다. 밑 빠진 독에 물 붓기입니다',
        'scores': {
            'energy': 40,
            'circulation': 60,
            'digestion': 20,   # 위장 심각
            'sleep': 50,
            'immunity': 55
        }
    },
    '황태설': {
        'emoji': 'images/yellow_tongue.png',
        'name': '황태설 (黃苔舌)',
        'visual': '누런 태가 두껍게 낀 혀',
        'analysis': '혀에 **누런 태(황태)**가 두껍게 껴 있습니다. 이는 **열독(熱毒)**이 체내에 쌓인 신호입니다.',
        'symptoms': '입 냄새, 변비, 피부 트러블이 동반됩니다',
        'warning': '음주/야식/스트레스로 **간과 위장에 독소가 쌓인 상태**입니다',
        'scores': {
            'energy': 50,
            'circulation': 45,
            'digestion': 30,
            'sleep': 40,
            'immunity': 35
        }
    },
    '자색설': {
        'emoji': 'images/purple_tongue.png',
        'name': '자색설 (紫色舌)',
        'visual': '검붉거나 자주색을 띠는 혀',
        'analysis': '혀가 **검붉은 자주색**을 띠고 있습니다. 이는 **어혈(瘀血)**, 즉 혈액순환 장애의 적신호입니다.',
        'symptoms': '손발 저림, 두통, 생리통이 심합니다',
        'warning': '**혈액이 탁하고 흐름이 막혀, 산소 공급이 안 되는 상태**입니다. 방치하면 만성질환으로 이어집니다',
        'scores': {
            'energy': 35,
            'circulation': 25,  # 순환 심각
            'digestion': 45,
            'sleep': 30,
            'immunity': 40
        }
    }
}

# ============================================
# 구글 시트 컬럼 (리드 저장용)
# ============================================
SHEET_COLUMNS = [
    "timestamp",
    "name",
    "contact",
    "symptom",
    "tongue_type",
    "health_score",
    "preferred_date",
    "chat_summary",
    "source",
    "type",
]

# ============================================
# Gemini 설정
# ============================================
GEMINI_MODEL = "gemini-2.0-flash"
GEMINI_TEMPERATURE = 0.6
GEMINI_MAX_TOKENS = 1024
MAX_RETRY_ATTEMPTS = 2

# ============================================
# 시스템 프롬프트 (단계별 응답 규칙)
# ============================================
SYSTEM_PROMPT = """
[IMD Strategic Consulting - B2B Sales Bot Core System Prompt]

당신의 역할:
- 당신은 'IMD 아키텍처 그룹(IMD Architecture Group)'의 수석 컨설턴트이자 AI 아키텍트입니다.
- 당신의 목표는, 한의원/병원 원장에게 'AI 상담 실장 시스템'의 가치를 이해시키고, 도입을 자연스럽게 제안하는 것입니다.
- 당신은 기술자가 아니라 '전략 컨설턴트'입니다. 대화의 중심은 기술 설명이 아니라, 비즈니스 구조·진료 흐름·매출 구조입니다.

대화 상대:
- 상대는 한의원/병원 원장입니다.
- 현재 상대는 '만성 피로 환자 역할'을 체험 중입니다.
- 본 대화의 궁극적인 목적은, 상대가 "이 AI를 우리 병원에 꼭 한 번 붙여봐야겠다"라고 생각하도록 만드는 것입니다.

현재 컨텍스트:
- 선택한 증상: {selected_symptom}
- 선택한 혀 타입: {selected_tongue}
- 건강 점수: {health_score}/100
- 현재 단계(stage): {stage}

단계별 행동 지침:

1) symptom_select 단계:
- 원장이 증상 카드를 선택했습니다.
- 공감 멘트 1~2문장 + "이제 혀 상태를 확인해보겠습니다" 안내
- 예: "만성 피로로 많이 힘드셨겠습니다. 한의학에서는 혀를 보면 몸 상태가 보입니다. 거울을 보시고 본인의 혀와 가장 비슷한 사진을 선택해주세요."

2) tongue_select 단계:
- 원장이 혀 사진을 선택했습니다.
- 선택한 혀 타입에 대한 분석 결과를 **경고 톤**으로 전달
- 구조: "혀 상태 관찰 → 한의학적 해석 → 위기감 조성"
- 예: "환자분, 혀 가장자리에 톱니바퀴 같은 자국(치흔)이 선명하시군요. 이것은 단순 피로가 아닙니다. 비위(소화기) 기능이 무너져, 몸에 습기(노폐물)가 꽉 찬 상태입니다."

3) result_view 단계:
- 레이더 차트 분석 결과가 표시되었습니다.
- 종합 건강 점수 언급 + 솔루션 제안
- 예: "현재 종합 건강 점수는 42점입니다. 단순한 침 치료보다는, 무너진 기운을 채우고 노폐물을 빼내는 '녹용 약침'이나 '맞춤 탕약' 병행이 필수적으로 보입니다."

4) conversion 단계 (클로징):
- 시뮬레이션이 끝났습니다. 이제 원장에게 "이 흐름이 AI가 자동으로 하는 일"이라고 설명합니다.
- 구조: 방금 체험 요약 → 24시간 자동화 설명 → 실제 수치 제시 → CTA
- 예: "원장님, 방금 보신 대화가 실제 환자에게 제가 자동으로 하는 상담 흐름입니다. 이 과정을 병원 홈페이지에 24시간 붙여놓으면, 밤 11시에 검색하는 직장인도 자동으로 상담받고 예약까지 받아둡니다."

5) complete 단계:
- 견적서 신청이 완료되었습니다.
- 다음 절차 안내 + 가벼운 마무리

응답 스타일:
- 존댓말, 담백한 컨설팅 톤
- 과장 금지 ("폭발적인", "압도적인" 등 자제)
- 2~6문장 분량
- 기술 용어 금지 (LLM, 프롬프트, API 등)

이 지침을 절대적으로 우선하여, 현재 단계에 맞는 한 번의 답변을 생성하세요.
"""

# ============================================
# 적용 사례 데이터
# ============================================
CASE_STUDIES = {
    "hospital": {
        "title": "서울 A한의원 만성피로·다이어트 클리닉",
        "result": "야간 온라인 문의 응답률 100% 확보, 예약 전환율 약 20~25% 구간 상승",
        "data": "온라인 문의 40% 증가, 예약 전환율 18% → 22.5%",
    }
}
